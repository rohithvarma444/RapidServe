pipeline {
    agent any

    environment {
        DOCKER_CREDENTIALS = credentials('dockerhub-creds')
    }

    stages {
        stage('Docker Login'){
            steps{
                script {
                    // Check if Docker is installed
                    def dockerCheck = sh(script: 'which docker || echo "NOT_FOUND"', returnStdout: true).trim()
                    if (dockerCheck == "NOT_FOUND") {
                        error("Docker is not installed on this Jenkins agent. Please install Docker or use a Docker-enabled agent.")
                    }
                    
                    // Login to Docker Hub
                    sh 'docker login -u $DOCKER_CREDENTIALS_USR -p $DOCKER_CREDENTIALS_PSW'
                }
            }
            post{
                success{
                    sh 'echo "Login to Docker Hub successful"'
                }
                failure{
                    sh 'echo "Login to Docker Hub failed"'
                }
            }
        }
    }
}